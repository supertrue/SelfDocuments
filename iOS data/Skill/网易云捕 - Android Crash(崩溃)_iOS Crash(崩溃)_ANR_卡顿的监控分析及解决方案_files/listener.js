define(["jquery","apkpack/utils/utils","apkpack/utils/renderUtils"],function(e,t,a){function n(e,t){var a="",s=[];if(e&&e.length&&"number"==typeof e.length){if(0==e.length)return"";for(dataIndex in e)e.hasOwnProperty(dataIndex)&&(0==dataIndex&&(a=r(e[dataIndex],t)),s.push(i(e[dataIndex],t)));return a+"\r\n"+s.join("\r\n")}return e?n([e],t):""}function i(e,t){var a=[];t=t?t:",";for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];i&&"string"==typeof i&&(i=e[n].replace(new RegExp('"',"g"),"'")),a.push('"'+i+'"')}return a.join(t)}function r(e,t){var a=[];t=t?t:",";for(var n in e)e.hasOwnProperty(n)&&a.push(""+n+'"');return a.join(t)}function s(t,a){t.stopPropagation();var n=e(this).parents(".m-select3").find(".m-select-ctn");n.find("li").removeClass("selected"),a&&a.length>0&&a.forEach(function(e){n.find("li[data-option-index='"+e+"']").addClass("selected")}),n.is(":visible")?e(".m-select-ctn").hide():(e(".m-select-ctn").hide(),n.removeClass("hidden").show())}function o(){var t=e(this);if(e(this).hasClass("selected"))return!1;var a=t.parents(".m-select3"),n=t.data().optionIndex,i=t.text();if(a.hasClass("app-type")&&requirejs(["doT","apkpack/utils/data"],function(t,a){var i=e(".app-sub-type"),r=a.subType[n][0];i.find(".selected-ctn").text(r),i.find("input.hidden").val(0);var s="{{~it:subType:index}}<li data-option-index='{{=index}}'>{{=subType}}</li>{{~}}",o=t.template(s);i.find(".m-select-ctn ul").html(o(a.subType[n])),i.removeClass("hidden").show()}),a.hasClass("multi")){t.hasClass("checked")?(t.removeClass("checked"),t.hasClass("check-all")&&a.find("li").removeClass("checked")):(t.addClass("checked"),t.hasClass("check-all")&&a.find("li").addClass("checked"));var r=a.find("li[data-option-index!='']"),s=a.find("li[data-option-index='']"),o=r.length,d=r.filter(".checked").length,c=!1;o===d?(s.addClass("checked"),c=!0):o>d&&s.removeClass("checked");var l="",p="";if(a.find(".selected-ctn").html(""),a.find("li.checked").each(function(t,n){l+=", "+e(n).data().optionIndex,p+=", "+e(n).text(),c||a.find(".selected-ctn").append("<span class='selected-item'>"+e(n).text()+"</span>")}),c&&a.find(".selected-ctn").append("<span class='selected-item'>"+s.text()+"</span>"),p.trim().startsWith(", ")&&(p=p.trim().substr(2)),l.trim().startsWith(", ")&&(l=l.trim().substr(2)),!p){var u=a.find(".selected-ctn");u.text(u.data("defaultText")),p=a.find(".selected-ctn").data().defaultText}a.find("input.hidden").val(l).trigger("change")}else a.find("input.hidden").val(n).trigger("change"),a.find(".selected-ctn").text(i),a.find(".m-select-ctn").hide();return n}function d(){e(this).attr("name","logo"),e(this).parent().find("input[name=token]").val(MAS.User.csrf);var a=e(this).get(0).files;a&&a[0]&&e.ajax("upload/logo.do",{type:"POST",processData:!1,contentType:!1,data:new FormData(e(this).parent().get(0))}).then(function(a){a&&a.success?(e(".app-info .applogo").css({background:"url("+a.data.url+")"}),e(".applogo input[name='logo']").val(a.data.key).data("logoUrl",a.data.url)):t.showAjaxError(a)},function(e){t.showAjaxError(e)})}function c(){var t=e(this).val(),a=t.match(/[^\x00-\xff]/gi),n=t.length+(null==a?0:a.length);0==n?e(this).attr("data-valid-success",!1).nextUntil("input","span.form-tip").text("App Name 不能为空").addClass("error"):n>40?e(this).attr("data-valid-success",!1).nextUntil("input","span.form-tip").text("App Name 字段过长").addClass("error"):e(this).attr("data-valid-success",!0).nextUntil("input","span.form-tip").hide()}function l(){e(this).nextUntil("input","span.form-tip").removeClass("error").text("不超过20个汉字或者40个英文字母").show()}function p(t){e(this).parent().find("input[name=token]").val(MAS.User.csrf);var a=e(this).get(0).files;a&&a[0]&&e.ajax("upload/file.do",{type:"POST",processData:!1,contentType:!1,data:new FormData(e(this).parent().get(0))}).then(function(e){e&&e.success?t.createHash("#dumply/crashLog/setting/#subTab=version-manager"):t.showAjaxError(e)},function(e){t.showAjaxError(e)})}function u(a,n,i){var r=void 0===i?1:i,s={type:"POST",data:{token:MAS.User.csrf,appId:a,ids:n,status:r}};e.ajax("crash/batchupdatedealstatus.do",s).then(function(a){var n=e(".dump-header");a&&a.success?i?(n.find("#logTitle, #dumpStack").addClass("handled"),n.find(".btn-set-handled").text("转为未处理").addClass("handled")):(n.find("#logTitle, #dumpStack").removeClass("handled"),n.find(".btn-set-handled").text("转为已处理").removeClass("handled")):t.showAjaxError(a)})}function h(a,n,i){var r=void 0===i?1:i,s={type:"POST",data:{token:MAS.User.csrf,appId:a,ids:n,status:r}};e.ajax("anr/batchUpdateDealStatus.do",s).then(function(a){if(a&&a.success){var n=e(".dump-header");i?(n.find("#logTitle, #dumpStack").addClass("handled"),n.find(".btn-set-handled").text("转为未处理").addClass("handled")):(n.find("#logTitle, #dumpStack").removeClass("handled"),n.find(".btn-set-handled").text("转为已处理").removeClass("handled"))}else t.showAjaxError()})}var f={index:{},apkpack:{},dumply:{},userCenter:{}};return f.index.common=function(){e("#loginButton").on("click",t.cursLogin);var a=!1;e(".doc").on("compositionstart","input.filter-input",function(){a=!0}).on("compositionend","input.filter-input",function(){a=!1}).on("input","input.filter-input",t.throttle(function(){if(!a){var t=e(this).val();e(this).parents(".m-select-ctn").find("ul li").each(function(a,n){var i=e(n);i.text().indexOf(t)<0?i.hide():i.show()})}},100));var n=e(".m-dialog.m-dialog-report");e(".g-rside").on("click","a.btn-go-top-rside",function(){e("body, html").animate({scrollTop:0},500)}).on("click","a.btn-report-rside",function(){t.showMask(),n.show().find("#reportContent+report-tip").text("")});var i=[];n.on("click","a.dlclose",function(){t.hideMask(),n.hide()}).on("click",".u-btn.btn-upload",function(){n.find("input[type=file][name=reportFile]").click()}).on("change","input[type=file][name=reportFile]",function(t){var a=e(this).get(0).files;if(a&&a.length>0){var r=n.find(".image-number"),s=e("#submitReportBtn"),o=i.length+a.length;r.find(".selected-number").text(o).parent().show();var d=r.parent().find(".report-tip").text("支持gif、jpg、png格式，且单个文件不超过500KB, 总计不超过5张图片").removeClass("error");o>5&&(r.find(".selected-number").addClass("error"),s.attr("disabled",!0)),require(["doT"],function(t){for(var n=t.template('<div style="background: url({{=it.src}}) no-repeat center; background-size: cover;" {{?it.tooLarge}}class="too-large"{{?}}><span class="delete-icon"></span><div class="image-name">{{!it.fileName}}</div></div>'),r=0;r<a.length;r++){var o=a[r];if(o.type.match("image.*")){var c=new FileReader;c.onload=function(t){return function(a){var i={src:a.target.result,fileName:t.name,tooLarge:t.size/1024>500};e(".m-dialog-report .preview-container").append(n(i))}}(o),c.readAsDataURL(o),i.push(o),o.size/1024>500&&(d.text('图片"'+o.name+'"的大小超过500k').addClass("error"),s.attr("disabled",!0))}}})}}).on("input","#reportContent",function(t){var a=e(this),n=a.val().trim().length;1e3>=n?a.next().removeClass("error").text("您还可以输入"+(1e3-n)+"个字符。"):a.next().text("反馈内容已超过上限"+(n-1e3)+"个字符。").addClass("error")}).on("click","#submitReportBtn",function(a){a.preventDefault();var r=e("#reportContent"),s=r.val().trim().length;return 0==s?(r.next().text("反馈内容不能为空").addClass("error"),!1):s>1e3?!1:void t.upload(e("#reportForm"),function(a){a&&a.success===!0?(t.niceAlert("投诉建议提交成功。"),n.hide(),r.val(""),e("input[name=reportFile]").val(""),n.find(".selected-number").text("0"),e(".preview-container > div").hide().remove(),i=[]):t.showAjaxError(a,!1)},{name:"reportFile",files:i})}).on("mouseenter",".preview-container > div",function(){e(this).find(".delete-icon").show()}).on("mouseleave",".preview-container > div",function(){e(this).find(".delete-icon").hide()}).on("click",".preview-container > div >.delete-icon",function(){var t=e(this);i.splice(t.parent().index(),1);var a=e(".selected-number");a.text(i.length),t.parent().hide().remove(),0===e(".preview-container> div.too-large").length&&(a.parent().next(".report-tip").text("支持gif、jpg、png格式，且单个文件不超过500KB, 总计不超过5张图片").removeClass("error"),i.length<=5&&(a.removeClass("error"),e("#submitReportBtn").attr("disabled",!1)))}),e(window).on("scroll",function(){var t=e(document).scrollTop(),a=e(".g-rside a.btn-go-top-rside");a.toggleClass("isShown",t>0);var n=location.hash,i=e(".header .top");if(n.indexOf("#dumply/crashLog/")>=0||n.indexOf("#userCenter")>=0&&MAS.User.account)return e(".header .top.fixed").removeClass("fixed"),void i.find("h3.logo a img").attr("src","image/index/v2/banner-logo-white-v2.png");var r=e(document).scrollTop(),s="icon_subnav_dropdown.png";if(r>0&&e(window).width()>720)i.addClass("fixed"),i.find("h3.logo a img").attr("src","image/index/v2/banner-logo-blue-v2.png"),s="icon_subnav_fixed.png",i.find(".nav i.arr").css("background","url(../../image/newStyle/icons/"+s+") no-repeat center center");else if(0===r&&e(window).width()>720){i.removeClass("fixed"),i.find("h3.logo a img").attr("src","image/index/v2/banner-logo-white-v2.png");var o=i.parent().attr("class");o.indexOf("index")>=0&&(s="icon_subnav_index.png"),i.find(".nav i.arr").css("background","url(../../image/newStyle/icons/"+s+") no-repeat center center")}})},f.userCenter.bindIndex=function(){var a=e(".userCenter").off();a.on("click",".tvhd li",function(){t.createHash(e(this).find("a").attr("href"))}).on("click",".btn-add-app",function(){t.createHash("#userCenter/addApp")}).on("click",".btn-add-solution",function(){var e="#dumply/solution/input";t.createHash(e)}).on("click",".delete-app",function(){var a=e(this),n=a.parents("tr").data().id;t.niceAlert({str:{alertContent:"点击确定将无法查看此APP的崩溃信息，要继续吗？"},btns:{cancel:!0},callback:{ok:function(){e.ajax("app/delete.do",{type:"POST",data:{appId:n,token:MAS.User.csrf}}).then(function(a){if(a&&a.success){MAS.User.appList.forEach(function(e,t){e.appId===n&&MAS.User.appList.splice(t,1)}),e(".app .app-list tr").each(function(t,a){e(a).data().appId===n&&e(this).hide().remove()});var i=t.getUserSettings("lastAppInfo");i&&i.appId===n&&localStorage.removeItem("lastAppInfo"+MAS.User.account),1===MAS.User.appList.length?e(".app .appname.has-dropdown").removeClass("has-dropdown").next().remove():0===MAS.User.appList.length&&(MAS.User.currentApp=null),t.createHash("#userCenter")}else t.showAjaxError(a)},function(){t.niceAlert("一定是点击姿势不对，请您换个姿势再点")})}}})}).on("click","li.app-list td.app-name",function(){var a=e(this).parents("tr").data().id;t.createHash("#dumply/crashLog/crash/#id="+a)}),a.on("change","input[type=radio][name='type']",function(){var t=e(".fitem.enterprise");1==e(this).val()?t.show():t.hide()}),a.on("click",".show-select-ctn",function(e){e.stopPropagation(),s.call(this,e)}).on("click",".m-select-ctn li",function(){var t=e(this).parents(".m-select3"),a=e(this).data().optionIndex,n=e(this).text();t.find("input.hidden").val(a).trigger("change"),t.find(".selected-ctn").text(n),t.find(".m-select-ctn").hide()}),a.on("click","a.upload-btn",function(){var t=e(this).parents(".control").find("input:text").attr("name");e("#uploadForm").find("input:file").data("name",t).click()}),e("#uploadForm").off().on("change","input:file",function(){var n=e(this);e(this).attr("name","image"),e(this).parent().find("input[name=token]").val(MAS.User.csrf);var i=e(this).get(0).files;i&&i[0]&&e.ajax("upload/image.do",{type:"POST",processData:!1,contentType:!1,data:new FormData(e(this).parent().get(0))}).then(function(e){e&&e.success?"idPhoto"===n.data().name?a.find("input[type=text][name=idPhoto]").val(e.data.key):a.find("input[type=text][name=licensePhoto]").val(e.data.key):t.showAjaxError(e)},function(e){t.showAjaxError(e)})}),a.find(".user-info-form").on("focus","input:visible",function(){var t=e(this).removeClass("error").siblings("span.form-tip");t.removeClass("error").text(t.data("defaultHint")).show()}),a.on("blur","input:visible",function(){var t,a,n=e(this),i=e(this).val(),r=e(this).siblings("span.form-tip");if(n.attr("required")&&""===n.val())return n.addClass("error"),void r.addClass("error").text("该字段不能为空");switch(n.attr("name")){case"qq":""==i||/^\d{6,13}$/.test(i)||r.addClass("error").text("QQ号必须为6~13位的阿拉伯数字").show();break;case"companyName":t=i.match(/[^\x00-\xff]/gi),a=i.length+(null==t?0:t.length),(i.indexOf(" ")>=0||0==a||a>60)&&(n.addClass("error"),r.addClass("error").text("不得大于30个汉字或者60个英文，且不能包含空格").show());break;case"realName":t=i.match(/[^\x00-\xff]/gi),a=i.length+(null==t?0:t.length),(0==a||a>40)&&(n.addClass("error"),r.addClass("error").text("姓名长度不得大于20个汉字或者40个英文").show());break;case"nickName":t=i.match(/[^\x00-\xff]/gi),a=i.length+(null==t?0:t.length),2>a||a>40?(n.addClass("error"),r.addClass("error").text("昵称长度必须大于2个字符，且不得大于20个汉字或者40个英文").show()):e.ajax("profile/checknickname.do",{data:{nickname:i}}).then(function(e){e&&e.success===!1&&(n.addClass("error"),r.addClass("error").text(e.msg).show())});break;case"idCard":""==i||/\d{15}|\d{18}|(\d{17}(x|X))/.test(i)||r.addClass("error").text("身份证号填写不正确")}r.hasClass("error")||r.hide()});var n=e(".m-dialog-check-security");a.on("click",".security-check.notbind",function(){e("body, html").animate({scrollTop:0},500),t.showMask(),n.show()}),n.off().on("click",".dlclose",function(){t.hideMask(),n.fadeOut()}).on("click",".check-group-phone",function(){window.open("https://reg.163.com/mibao/mob/bindIndex.do?noheader=0&url=")}).on("click",".check-group-mkey",function(){window.open("https://reg.163.com/otp/controller/index.jsp")}),a.on("click","#updateProfile",function(){var a=e(".user-info-form");if(a.find(".form-tip.error:visible").length>0)return void t.niceAlert("请检查所有的字段都正确后再提交");var n={};a.find("input").each(function(t,a){var i=e(a).attr("name"),r=e(a).val();i&&("radio"!=e(a).attr("type")||e(a).prop("checked"))&&(n[i]=r)}),e.ajax("profile/update.do",{type:"POST",data:{profile:JSON.stringify(n),token:MAS.User.csrf}}).then(function(e){e.success?(t.niceAlert("修改成功"),t.createHash("#userCenter/profile")):t.showAjaxError(e)})}),a.on("click",".solution-list td.solution-title",function(){var t=e(this).parents("tr").data("id");e.ajax("solution/query.do",{data:{solutionId:t}}).then(function(t){t&&t.success&&require(["doT"],function(a){var n=a.template(e("#singleSolutionTpl").text());e("#userCenterDash, #addAppDash").hide(),e("#singleSolutionDash").show().find(".dashbd").html(n(t.data.object)),e(document).ready(function(){e("pre code").each(function(e,t){hljs.highlightBlock(t)})})})})}).on("click","a.edit-solution",function(){var a=e(this).parents("tr"),n="#dumply/solution/edit/#!solutionId="+a.data("id")+"&appId="+a.data("appId")+"&exceptionTypeId="+a.data("exceptionTypeId")+"&type="+a.data("type");t.createHash(n)}).on("click","a.delete-solution",function(){var a=e(this).parents("tr"),n=a.data("id");t.niceAlert({str:{alertContent:"确定要删除这条解决方案吗？",subContent:"删除后不可恢复，请谨慎操作。"},btns:{ok:!0,cancel:!0},callback:{ok:function(){e.ajax("solution/delete.do",{type:"POST",data:{solutionId:n,token:MAS.User.csrf}}).then(function(){a.hide()})}},hideMask:!0})}).on("click","#singleSolutionDash .dashtt a",function(){t.createHash(e(this).data("href"))})},f.userCenter.bindAddApp=function(){var a=e("#addAppDash").off();e(".applogo, a.btn-update-logo").on("click",function(){e("#uploadForm").find("input:file").click()}),e("#uploadForm").off().on("change","input:file",function(){e(this).attr("name","logo"),e(this).parent().find("input[name=token]").val(MAS.User.csrf);var a=e(this).get(0).files;a&&a[0]&&(e("#btnAddAppOK").attr("disabled",!0),e.ajax("upload/logo.do",{type:"POST",processData:!1,contentType:!1,data:new FormData(e(this).parent().get(0))}).then(function(a){a&&a.success?(e("#addAppDash .applogo").css({background:"url("+a.data.url+")"}).data("url",a.data.url),e(".applogo input[name='logo']").val(a.data.key)):t.showAjaxError(a),e("#btnAddAppOK").attr("disabled",!1)},function(a){t.showAjaxError(a),e("#btnAddAppOK").attr("disabled",!1)}))}),a.on("blur","input[name='appName']",function(){var t=e(this).val(),a=t.match(/[^\x00-\xff]/gi),n=t.length+(null==a?0:a.length);0==n?e(this).attr("data-valid-success",!1).next().text("App Name 不能为空").addClass("error"):n>40?e(this).attr("data-valid-success",!1).next().text("App Name 字段过长").addClass("error"):e(this).attr("data-valid-success",!0).next().hide()}).on("focus","input[name='appName']",function(){e(this).next().removeClass("error").html("不超过20个汉字或者40个英文字母").show()}),a.on("blur","input[name='email']",function(){e(this).val().length>0&&!e(this).val().match(/^(([a-z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6}))|(1\d{10})$/)?e(this).attr("data-valid-success",!1).parents(".roleInputGroup").find(".form-tip").text("云账号格式不正确"):e(this).attr("data-valid-success",!0)}).on("focus","input[name='email']",function(){e(this).parents(".roleInputGroup").find(".form-tip").text("")}),a.on("click",".btn-add-member",function(){e(".add-role .roleInputGroup").last().after(a.find(".roleInputGroup.hidden").clone().removeClass("hidden"))}),a.on("mouseenter",".btn-member-def",function(){e(".role-def").fadeIn()}).on("mouseleave",".btn-member-def",function(){e(".role-def").fadeOut()}),a.on("click",".show-select-ctn",function(e){e.stopPropagation(),s.call(this,e)}).on("click",".m-select-ctn li",function(){var t=e(this).parents(".m-select3"),a=e(this).data().optionIndex,n=e(this).text();t.hasClass("app-type")&&requirejs(["doT","apkpack/utils/data"],function(t,n){var i=e(".app-sub-type"),r=n.subType[a][0];i.find(".selected-ctn").text(r),i.find("input.hidden").val(0);var s="{{~it:subType:index}}<li data-option-index='{{=index}}'>{{=subType}}</li>{{~}}",o=t.template(s);i.find(".m-select-ctn ul").html(o(n.subType[a])),i.removeClass("hidden").show()}),t.find("input.hidden").val(a),t.find(".selected-ctn").text(n),t.find(".m-select-ctn").hide()}),a.on("click","#btnAddAppOK:not([disabled])",function(){var n=a.find("input[name='type']").val(),i=a.find("input[name='subType']").val();if(""==n||""==i||e("input[data-valid-success='false']").length>0)return void t.niceAlert("包含不正确的字段，请更正后再提交");if(0==a.find("input[type=radio]:checked").length)return t.niceAlert("请选择 APP 所属的操作系统。"),!1;var r={appName:a.find("input[name='appName']").val(),os:a.find("input[name='os']:checked").val(),logo:a.find("input[name='logo']").val(),type:n,subType:i},s=[];a.find(".roleInputGroup").each(function(t,a){var n={email:e(a).find("input[name='email']").val(),role:e(a).find("input[name='role']").val()};n.email&&s.push(n)});var o=e("#addAppForm");o.find("input[name='appInfo']").val(JSON.stringify(r)),o.find("input[name='memberInfo']").val(JSON.stringify(s)),o.find("input[name=token]").val(MAS.User.csrf),e.ajax("app/insert.do",{type:"POST",data:o.serialize(),success:function(a){if(a&&a.success>0)a.data.appName=a.data.appName||r.appName,a.data.logo=e("#addAppDash .applogo").data("url")||"http://apk-pack-public-test.nos.netease.com/logo_icon.jpg?imageView",a.data.os=a.data.os||r.os,a.data.role=0,MAS.User.appList.push(a.data),requirejs(["text!../html/userCenter/addAppSuccess.html","doT","zeroClipboard"],function(t,n,i){var r=a.data,s=n.template(t);e(".content").removeClass("visible"),e(".content.userCenter").html(s(r)).addClass("visible");var o=e(".handle-container a.copy-after-create"),d=new i(o.get(0));if(d.on("error",function(t){d.destroy(),o.off().on("click",function(){prompt("未检测到flash，请按 Ctrl + c 手动复制",e(".handle-container .app-info").data("appId"))})}),d.on("ready",function(){d.on("copy",function(t){t.clipboardData.setData("text/plain",e(".handle-container .app-info").data("appId"))}).on("aftercopy",function(e){o.addClass("copy-success"),setTimeout(function(){o.removeClass("copy-success")},3e3)})}),e(".dropmn .app-list").length>0){var c='<tr data-app-id="{{=it.appId}}"> <td class="cola"><img src="{{=it.logo}}" alt="App Logo"></td> <td><h3 data-app-name="{{!it.appName}}"><span title="{{!it.appName}}">{{!it.appName}}</span><span>AppId: {{=it.appId}}</span> </h3></td> <td class="f-tar"><img class="plant" src="{{?it.os == "android"}}image/newStyle/icons/android.png{{??}}image/newStyle/icons/ios.png{{?}}" alt="platform logo"></td> </tr>',l=n.template(c);e(".dropmn table.app-list tbody").append(l(a.data))}MAS.User.appList.length>=2&&e(".dropctn").prev(".appname").addClass("has-dropdown").after('<span class="dropmenu"></span>')});else{var n=a&&a.msg||"一定是点击姿势不对，请您换个姿势再点击";t.niceAlert(n)}}})})},f.apkpack.bindIndex=function(){},f.apkpack.bindResult=function(t){requirejs(["datetimepicker","apkpack/widget/paginator"],function(a,n){e.datetimepicker.setLocale("zh"),e("#datePicker").datetimepicker({format:"Y-m-d",timepicker:!1,maxDate:0,defaultDate:t.data.insertTime?t.data.insertTime:new Date,minDate:"-1970/01/14",onSelectDate:function(e,a){var n=e.dateFormat("Y-m-d"),i=t.data.page,r=t.data.perpage;window.location.hash="#apkpack/result/"+n+"/"+i+"/"+r}}).val(t.data&&t.data.insertTime?t.data.insertTime:(new Date).dateFormat("Y-m-d"));var i=new n(".pagetool",t.data),r=e(".pagetool");e("#operator").on("change","select",function(t){e(t.delegateTarget).find(".ckd").html(t.target.value);var a=e("#datePicker").val(),n=i.currentPage,r=i.perpage,s="#apkpack/result/"+a+"/"+n+"/"+r;"all"==t.target.value&&(s+="/all"),window.location.hash=s}),r.find("select").on("change",function(t){var a=e(this).val();e(".optvalue").html(a);var n=i.currentPage,r=e("#datePicker").val();window.location.hash="#apkpack/result/"+r+"/"+n+"/"+a}),r.find("p>a").on("click",function(t){if(!(e(this).attr("class").search("z-dis")>=0)){var a=e(this).data().page,n=i.perpage,r=e("#datePicker").val();window.location.hash="#apkpack/result/"+r+"/"+a+"/"+n}}),e("#packResult").on("click","td[data-id]",function(t){var a=e(this).data().id;e("#hiddenDownolad").attr("src","downloadApk.do?id="+a)})})},f.dumply.bindCrashLog=function(){e("#searchGroup").off().on("click",".show-select-ctn",function(e){s.call(this,e)}).on("click",".m-select-ctn li",function(){o.call(this)}).on("change","input.hidden",function(){var n=e(this),i={};i[n.attr("name")]=n.val(),t.setUserSettings(i,"crash"),e(".m-pagecount input[type=text]").val(1),n.parents(".m-select3").find(".selected-ctn").toggleClass("not-default-val",n.val()!=n.data("defaultVal")),a.dumply.showDumpList()}).on("click","input[name=searchText]",function(e){e.stopPropagation()}).on("focus","input[name=searchText]",function(){e(this).siblings(".search-tooltip").removeClass("hidden").show()}).on("input","input[name=searchText]",function(){var t=e(this).val(),a=e(this).siblings(".search-tooltip");a.find(".search-content").text(t)}).on("click",".search-tooltip li",function(){var t=e(this).find(".search-content");e(this).parents(".search-tooltip").fadeOut(),e(".m-pagecount input[type=text]").val(1);var n={type:t.data().searchTitle,content:t.text()};t.parents(".search").data("specialQueryParam",n),a.dumply.showDumpList(n)}),e("#trendToday").on("click","[data-chart-type], [data-chart-time]",function(){var t=e(this);t.addClass("act").siblings().removeClass("act");var n={appId:MAS.User.currentApp.appId,version:JSON.stringify([""]),chartType:e("a[data-chart-type].act").data("chartType"),time:e("div[data-chart-time].act").data("chartTime")},i="时间点：{b}<br>值： {c} ";"rate"===n.chartType?i="时间点：{b}<br>Crash 率 {c}%":"num"===n.chartType?i="时间点：{b}<br>Crash 次数 {c} 次":"userNum"===n.chartType?i="时间点：{b}<br>影响用户 {c} 人":"totalUserNum"===n.chartType&&(i="时间点：{b}<br>启动用户 {c} 人");var r={dataUrl:"crash/getcrashtrend.do",ajaxParam:{data:n},chartContainer:e("#trendToday .chart")[0],tooltipFormatter:i};a.dumply.showTrendChart(r)})},f.dumply.bindDumpList=function(){e("#dumpListBox").on("click","th.order",function(){var n=e(this),i="desc"===n.data("orderType")?"asc":"desc";t.setUserSettings({orderType:i,orderBy:n.data("orderBy")},"crash"),n.data({order:!0,orderType:i}).attr({"data-order":!0,"data-order-type":i}).siblings(".order").data({order:!1,orderType:""}).attr({"data-order":!1,"data-order-type":""}),a.dumply.showDumpList()}).on("click",".m-pagecount a.pre",function(){if(e(this).next().val()>1){e(this).next().val(e(this).next().val()-1);var t=e("input[name=searchText]"),n=void 0;""!==t.val()&&(n=t.parents(".search").data("specialQueryParam")),a.dumply.showDumpList(n)}}).on("click",".m-pagecount a.next",function(){var t=e(this).siblings("input[type=text]"),n=e("#totalPage").data().pagenum;if(t.val()<n){t.val(parseInt(t.val())+1);var i=e("input[name=searchText]"),r=void 0;""!==i.val()&&(r=i.parents(".search").data("specialQueryParam")),a.dumply.showDumpList(r)}}).on("change",".m-pagecount input[type=text]",function(){var t=e("#totalPage").data().pagenum;if(e(this).val()>t)e(this).val(t);else if(e(this).val()<1)e(this).val(1);else{var n=parseInt(e(this).val());e(this).val(n?n:1)}var i=e("input[name=searchText]"),r=void 0;""!==i.val()&&(r=i.parents(".search").data("specialQueryParam")),a.dumply.showDumpList(r)}).on("change",".checkAllBox",function(){e(this).prop("checked")?e("tr.dump").find("input[type=checkbox]").prop("checked",!0):e("tr.dump").find("input[type=checkbox]").prop("checked",!1)}).on("change","tr.dump input[type=checkbox]",function(){!e(this).prop("checked")&&e(".checkAllBox").prop("checked")&&e(".checkAllBox").prop("checked",!1)}).on("click","#setHandledBtn",function(){var a=[];if(e("tr.dump").find("input[type=checkbox]:checked").length>0){var n={token:MAS.User.csrf,appId:MAS.User.currentApp.appId,ids:function(){var t="";return e("tr").not(".handled").find("input[type=checkbox]:checked").each(function(n,i){var r=e(i).parents("tr"),s=r.find("td[data-crash-type-id]");!r.hasClass("handled")&&s.length>0&&(t+=s.data().crashTypeId+",",a.push(i))}),t}(),status:1};n.ids&&n.ids.length>0?e.ajax({url:"crash/batchupdatedealstatus.do",data:n,type:"POST",success:function(n){n.success?(e(".checkAllBox").prop("checked",!1),a.forEach(function(t){e(t).prop("checked",!1),e(t).parents("tr.dump").addClass("handled")}),e("tr.dump input[type=checkbox]").prop("checked",!1)):t.showAjaxError(n),a=[]},error:function(){t.niceAlert("设置错误，请稍后再试")}}):e(".isdeal").find("input[type=checkbox]:checked").prop("checked",!1)}}).on("click","#setUnhandledBtn",function(){var a=[];if(e("tr.dump").find("input[type=checkbox]:checked").length>0){var n={token:MAS.User.csrf,appId:MAS.User.currentApp.appId,ids:function(){var t="";return e("tr.handled").find("input[type=checkbox]:checked").each(function(n,i){var r=e(i).parents("tr"),s=r.find("td[data-crash-type-id]");r.hasClass("handled")&&s.length>0&&(t+=s.data().crashTypeId+",",a.push(i))}),t}(),status:0};n.ids&&n.ids.length>0?e.ajax({url:"crash/batchupdatedealstatus.do",data:n,type:"POST",success:function(n){n.success?(e(".checkAllBox").prop("checked",!1),a.forEach(function(t){e(t).prop("checked",!1),e(t).parents("tr.dump").removeClass("handled")}),e("tr.dump input[type=checkbox]").prop("checked",!1)):t.showAjaxError(n),a=[]},error:function(){t.niceAlert("设置错误，请稍后再试")}}):e(".isdeal").find("input[type=checkbox]:checked").prop("checked",!1)}}).on("click","#downloadAsCsv",function(){var t;switch(e("#crashTime").val()){case"month":t=new Date((new Date).getTime()-2592e6).toISOString().substr(0,10);break;case"week":t=new Date((new Date).getTime()-6048e5).toISOString().substr(0,10);break;case"today":default:t=(new Date).toISOString().substr(0,10)}var a={appname:e("span.appname").text(),version:e("#appVersionSelector").val(),startDate:t,endDate:(new Date).toISOString().substr(0,10),crashType:function(){var t=[];return e("tr.dump").find("input[type=checkbox]:checked").each(function(a,n){var i={};i.logTitle=e(n).parents("tr").find(".title").text().trim(),i.dumpStack=e(n).parents("tr").find(".dumpStack").text().trim(),t.push(i.logTitle+"\r\n"+i.dumpStack)}),t}()};a.crashType&&a.crashType.length>0&&(e.ajax({url:"dumply/api/downloadDumply.do",data:a,type:"POST",success:function(e){var t=document.createElement("a"),a=new Blob([n(e)],{type:"text/csv"}),i=document.createEvent("HTMLEvents");i.initEvent("click",!1,!1),t.download="崩溃详情.csv",t.href=URL.createObjectURL(a),t.dispatchEvent(i)},error:function(e){console.dir(e)}}),e("tr.dump").find("input[type=checkbox]:checked").each(function(t,a){e(a).prop("checked",!1)}))}).on("click","td.dumpDetail",function(t){var a=e(t.target).data("href");if(a)window.open(a);else{var n="#dumply/crashLog/detail/#id="+MAS.User.currentApp.appId+"&version="+e("#appVersionSelector").val()+"&crashTypeId="+e(this).prev().data().crashTypeId+"&time="+e("#crashTime").val();window.open(n)}})},f.dumply.bindAnr=function(){e("#anrSearchGroup").off().on("click",".show-select-ctn",function(e){s.call(this,e)}).on("click",".m-select-ctn li",function(){o.call(this)}).on("change","input.hidden",function(){var n=e(this),i={};i[n.attr("name")]=n.val(),t.setUserSettings(i,"anr"),n.parents(".m-select3").find(".selected-ctn").toggleClass("not-default-val",n.val()!=n.data("defaultVal")),e(".m-pagecount input[type=text]").val(1),a.dumply.showAnrList()}).on("click","input[name=searchText]",function(e){e.stopPropagation()}).on("focus","input[name=searchText]",function(){e(this).siblings(".search-tooltip").removeClass("hidden").show()}).on("input","input[name=searchText]",function(){var t=e(this).val(),a=e(this).siblings(".search-tooltip");a.find(".search-content").text(t)}).on("click",".search-tooltip li",function(){var t=e(this).find(".search-content");e(this).parents(".search-tooltip").fadeOut(),e(".m-pagecount input[type=text]").val(1);var n={type:t.data("searchTitle"),content:t.text()};t.parents(".search").data("specialQueryParam",n),a.dumply.showAnrList(n)});var n=e("#anrTrend").off();n.on("click","[data-chart-type], [data-chart-time]",function(){var t=e(this);t.addClass("act").siblings().removeClass("act");var i={appId:MAS.User.currentApp.appId,version:JSON.stringify([""]),chartType:n.find("a[data-chart-type].act").data("chartType"),time:n.find("div[data-chart-time].act").data("chartTime")},r="时间点：{b}<br>值用户 {c} 人";"rate"===i.chartType?r="时间点：{b}<br> "+("ios"===MAS.User.currentApp.os?"卡顿":"ANR")+"率 {c}%":"num"===i.chartType?r="时间点：{b}<br>"+("ios"===MAS.User.currentApp.os?"卡顿":"ANR")+"次数 {c} 次":"userNum"===i.chartType?r="时间点：{b}<br>影响用户 {c} 人":"totalUserNum"===i.chartType&&(r="时间点：{b}<br>启动用户 {c} 人");var s={dataUrl:"anr/trend.do",ajaxParam:{data:i},chartContainer:e("#anrTrend .chart")[0],tooltipFormatter:r};a.dumply.showTrendChart(s)})},f.dumply.bindAnrList=function(){e("#anrListBox").on("click","th.order",function(){var n=e(this),i="desc"===n.data("orderType")?"asc":"desc";t.setUserSettings({orderType:i,orderBy:n.data("orderBy")},"anr"),n.data({order:!0,orderType:i}).attr({"data-order":!0,"data-order-type":i}).siblings(".order").data({order:!1,orderType:""}).attr({"data-order":!1,"data-order-type":""}),a.dumply.showAnrList()}).on("click",".m-pagecount a.pre",function(){if(e(this).next().val()>1){e(this).next().val(e(this).next().val()-1);var t=e("input[name=searchText]"),n=void 0;""!==t.val()&&(n=t.parents(".search").data("specialQueryParam")),a.dumply.showAnrList(n)}}).on("click",".m-pagecount a.next",function(){var t=e(this).siblings("input[type=text]"),n=e("#totalAnrPage").data("pagenum");if(t.val()<n){t.val(parseInt(t.val())+1);var i=e("input[name=searchText]"),r=void 0;""!==i.val()&&(r=i.parents(".search").data("specialQueryParam")),a.dumply.showAnrList(r)}}).on("change",".m-pagecount input[type=text]",function(){var t=e("#totalAnrPage").data("pagenum");if(e(this).val()>t)e(this).val(t);else if(e(this).val()<1)e(this).val(1);else{var n=parseInt(e(this).val());e(this).val(n?n:1)}var i=e("input[name=searchText]"),r=void 0;""!==i.val()&&(r=i.parents(".search").data("specialQueryParam")),a.dumply.showAnrList(r)}).on("change",".checkAllBox",function(){e(this).prop("checked")?e("tr.dump").find("input[type=checkbox]").prop("checked",!0):e("tr.dump").find("input[type=checkbox]").prop("checked",!1)}).on("change","tr.dump input[type=checkbox]",function(){!e(this).prop("checked")&&e(".checkAllBox").prop("checked")&&e(".checkAllBox").prop("checked",!1)}).on("click","#setAnrHandledBtn",function(){var a=[];if(e("tr.dump").find("input[type=checkbox]:checked").length>0){var n={token:MAS.User.csrf,appId:MAS.User.currentApp.appId,ids:function(){var t="";return e("tr").not(".handled").find("input[type=checkbox]:checked").each(function(n,i){var r=e(i).parents("tr"),s=r.find("td[data-type-id]");
!r.hasClass("handled")&&s.length>0&&(t+=s.data().typeId+",",a.push(i))}),t}(),status:1};n.ids&&n.ids.length>0?e.ajax({url:"anr/batchUpdateDealStatus.do",data:n,type:"POST",success:function(n){n.success?(e(".checkAllBox").prop("checked",!1),a.forEach(function(t){e(t).prop("checked",!1),e(t).parents("tr.dump").addClass("handled")}),e("tr.dump input[type=checkbox]").prop("checked",!1)):t.showAjaxError(n),a=[]},error:function(){t.niceAlert("设置错误，请稍后再试")}}):e(".isdeal").find("input[type=checkbox]:checked").prop("checked",!1)}}).on("click","#setAnrUnhandledBtn",function(){var a=[];if(e("tr.dump").find("input[type=checkbox]:checked").length>0){var n={token:MAS.User.csrf,appId:MAS.User.currentApp.appId,ids:function(){var t="";return e("tr.handled").find("input[type=checkbox]:checked").each(function(n,i){var r=e(i).parents("tr"),s=r.find("td[data-type-id]");r.hasClass("handled")&&s.length>0&&(t+=s.data("typeId")+",",a.push(i))}),t}(),status:0};n.ids&&n.ids.length>0?e.ajax({url:"anr/batchUpdateDealStatus.do",data:n,type:"POST",success:function(n){n.success?(e(".checkAllBox").prop("checked",!1),a.forEach(function(t){e(t).prop("checked",!1),e(t).parents("tr.dump").removeClass("handled")}),e("tr.dump input[type=checkbox]").prop("checked",!1)):t.showAjaxError(n),a=[]},error:function(){t.niceAlert("设置错误，请稍后再试")}}):e(".isdeal").find("input[type=checkbox]:checked").prop("checked",!1)}}).on("click","td.anrDetail",function(t){var a=e(t.target).data("href");if(a)window.open(a);else{var n="#dumply/crashLog/anrDetail/#id="+MAS.User.currentApp.appId+"&version="+e("#appVersionSelector").val()+"&typeId="+e(this).prev().data("typeId")+"&time="+e("#anrTime").val();window.open(n)}})},f.dumply.bindAnrDetail=function(){var n=t.parseDumplyParam();e("#anrDetailCtn").on("click",".btn-show-more",function(){var e=location.hash.replace("#dumply/crashLog/anrDetail","#dumply/anrDetailList/showMore");window.open("index.do"+e)}).on("click",".btn-set-handled",function(){var t=e(this).hasClass("handled")?0:1;h.call(this,n.appId,n.typeId,t)}).on("change","input[name=period]",function(){var n=e("input[name=period]").val();if("custom"==n)e("#dateRange").data("dateRangePicker").open();else{var i=t.parseDumplyParam(),r=""!==i.version?i.version:e("#appVersion").text().trim(),s={type:"POST",data:{appId:i.appId||MAS.User.currentApp.appId,version:JSON.stringify([r]),anrType:e("div.dump-header").data("anrType"),time:n,chartType:"num"}},o={dataUrl:"anr/trend.do",time:i.period||n,ajaxParam:s,chartContainer:e(".trend-chart-container")[0]};a.dumply.showTrendChart(o)}}).on("click",".tvhd.recentCrash li",function(){e("div.crash-detail-panel").addClass("loading"),e("#appVersion").length>0&&(n.version=e("#appVersion").text().trim()),n.offset=e(this).data().offset,n.anrType=e(".dump-header").data("anrType"),a.dumply.showAnrDetail(n),e(this).parents("ul").find("li").removeClass("act"),e(this).addClass("act")}).on("click",".tvhd.crash-detail li",function(){var t=e(this);t.parents("ul").find("li").removeClass("act"),t.addClass("act");var a=t.parents(".m-tabview").find(".tvbd>ul");a.find("li").removeClass("act"),a.find("li."+t.data().tabIndex).addClass("act")}).on("click",".show-select-ctn",s).on("click",".m-select-ctn li",o).on("change","input[name=logLevel]",a.dumply.filterLog).on("keyup","input[name=filterText]",t.throttle(a.dumply.filterLog,200))},f.dumply.bindDetail=function(){var n=t.parseDumplyParam();e("#dumpDetailCtn").on("click",".btn-show-more",function(){var e=location.hash.replace("#dumply/crashLog/detail","#dumply/detailList/showMore");window.open("index.do"+e)}).on("click",".btn-set-handled",function(){var t=e(this).hasClass("handled")?0:1;u.call(this,n.appId,n.crashTypeId,t)}).on("change","input[name=period]",function(){var n=e("input[name=period]").val();if("custom"==n)e("#dateRange").data("dateRangePicker").open();else{var i=t.parseDumplyParam(),r=""!==i.version?i.version:e("#appVersion").text().trim(),s={type:"POST",data:{appId:i.appId||MAS.User.currentApp.appId,version:JSON.stringify([r]),crashType:e("div.dump-header").data().crashType,time:n,chartType:"num"}},o={dataUrl:"crash/getcrashtrend.do",time:i.period||n,ajaxParam:s,chartContainer:e(".trend-chart-container")[0]};a.dumply.showTrendChart(o)}}).on("click",".tvhd.recentCrash li",function(){e("div.crash-detail-panel").addClass("loading"),e("#appVersion").length>0&&(n.version=e("#appVersion").text().trim()),n.offset=e(this).data().offset,n.crashType=e(".dump-header").data().crashType,a.dumply.showRecentCrash(n),e(this).parents("ul").find("li").removeClass("act"),e(this).addClass("act")}).on("click",".tvhd.crash-detail li",function(){var t=e(this);t.parents("ul").find("li").removeClass("act"),t.addClass("act");var a=t.parents(".m-tabview").find(".tvbd>ul");a.find("li").removeClass("act"),a.find("li."+t.data().tabIndex).addClass("act")}).on("click",".show-select-ctn",s).on("click",".m-select-ctn li",o).on("change","input[name=logLevel]",a.dumply.filterLog).on("keyup","input[name=filterText]",t.throttle(a.dumply.filterLog,200))},f.dumply.bindDetailSelectDateRange=function(n){var i=t.parseDumplyParam(),r=i.version||e("input[name=version]").val(),s={type:"POST",data:{appId:i.appId||MAS.User.currentApp.appId,version:JSON.stringify([r]),time:"custom",crashType:e("div.dump-header").data().crashType,chartType:"num",startDate:n.startDate,endDate:n.endDate}};s.data.version===JSON.stringify([""])&&(s.data.version=JSON.stringify([e("#appVersion").text().trim()]));var o={dataUrl:"crash/getcrashtrend.do",time:"custom",ajaxParam:s,chartContainer:e(".trend-chart-container")[0]};a.dumply.showTrendChart(o)},f.dumply.bindAnrDetailSelectDateRange=function(n){var i=t.parseDumplyParam(),r=i.version||e("input[name=version]").val(),s={type:"POST",data:{appId:i.appId||MAS.User.currentApp.appId,version:JSON.stringify([r]),time:"custom",type:e("[data-type]").data("type"),chartType:"num",startDate:n.startDate,endDate:n.endDate}};s.data.version===JSON.stringify([""])&&(s.data.version=JSON.stringify([e("#appVersion").text().trim()]));var o={dataUrl:"anr/trend.do",time:"custom",ajaxParam:s,chartContainer:e(".trend-chart-container")[0]};a.dumply.showTrendChart(o)},f.dumply.bindDetailList=function(){e(".dump-header").on("click",".btn-set-handled",function(){var a=t.parseDumplyParam(),n=e(this).hasClass("handled")?0:1;u.call(this,a.appId,a.crashTypeId,n)}),e(".dump-list").on("click","li[data-log-id]",function(){e("div.panelbd:visible").addClass("loading"),e(this).parent().find("li").removeClass("act"),e(this).addClass("act");var a=t.parseDumplyParam();a.id=e(this).data().logId,e.ajax("crash/getrecentlycrashdetailbyid.do",{type:"POST",data:{queryCrashInfo:JSON.stringify(a)}}).then(function(n){if(n&&n.success){var i=n.data.object||{};requirejs(["doT","moment"],function(t,n){for(var r in i)if(i.hasOwnProperty(r)){var s=i[r];"startTime"!=r&&"crashTime"!=r||(s=n(s).format("YYYY-MM-DD HH:mm:ss")),e("#crash_"+r).text(s)}"iPhone OS"!==i.os&&"watchOS"!==i.os||(e(".ios-modify-IMEI").text("设备 ID"),e(".ios-modify-SD").text("磁盘可用占比"),e("#crash_imei").hide(),e("#crash_availSdSize").parent().hide(),e(".tvhd li[data-tab-index='sys-log']").hide(),e(".tvhd li[data-tab-index=user-param]").text("其它信息")),e(".crashId").html(i.id),e("#crashTime").html(n(i.crashTime).format("YYYY-MM-DD HH:mm:ss")),e("#uploadTime").html(n(i.reportTime).format("YYYY-MM-DD HH:mm:ss"));var o=e("#dumpStackTpl").text(),d=i.logContent&&i.logContent.split("\n")||[],c=i.userLog&&i.userLog.split("\n")||[],l=i.userParam&&i.userParam.split("\n")||[],p=i.sysLog&&i.sysLog.split("\n")||[],u=i.threadInfo&&i.threadInfo.split("\n")||[],h=t.template(o);e("#dumpStackFull").html(h(d)),e("#userLogList").html(h(c)),e("#userParamList").html(h(l)),e("#sysLogList").html(h(p)),e("#threadInfoList").html(h(u)),e("div.panelbd:visible").removeClass("loading");var f={data:{exceptionSolution:JSON.stringify({exceptionTypeId:e("[data-crash-type-id]").data("crashTypeId"),appId:a.appId,type:"crash"})}};e.ajax("solution/count.do",f).then(function(t){if(t&&t.success){var n=t.data.count||0,i=n>0?n+"条解决方案":"我有解决方案",r="#dumply/solution/"+(n>0?"read":"input")+"/#!type=crash&exceptionTypeId="+e("[data-crash-type-id]").data("crashTypeId")+"&offset="+a.offset+"&appId="+a.appId;e("#dumpDetailCtn").find("a.btn-solution").text(i).attr("href",r).removeClass("hidden").toggleClass("offer-solution",0>=n)}})})}else t.showAjaxError(n),e("div.panelbd:visible").removeClass("loading")})}).on("click",".m-paginator a.prev, .m-paginator a.next",function(){var a=e(this);if(a.not("[disabled]").length>0){var n=a.parent().data().limit||20,i=a.data().page,r=(i-1)*n,s=t.parseDumplyParam();s.offset=r,s.limit=n,s.version=e("#appVersion").text(),s.crashType=e("[data-crash-type]").data().crashType;var o={type:"POST",data:{queryCrashInfo:JSON.stringify(s)}};e.ajax("crash/getcrashinfolist.do",o).then(function(a){a&&a.success?requirejs(["doT","moment"],function(t,r){var s=t.template(e("#dumpListTpl").html()),o=a.data&&a.data.list||[];o.forEach(function(e){e.reportTime=r(e.reportTime).format("YYYY-MM-DD HH:mm:ss")}),e(".dump-list ul").html(s(o)),e(".dump-list li").first().click();var d=parseInt(e("#crashTimes").text()),c={page:i||1,limit:n||20};c.offset=(c.page-1)*c.limit,c.totalPage=Math.ceil(d/c.limit);var l=t.template(e("#paginatorTpl").text());e(".dump-list ul").append(l(c))}):t.showAjaxError()})}}),e(".dump-detail").on("click",".tvhd.crash-detail li",function(){var t=e(this);t.parents("ul").find("li").removeClass("act"),t.addClass("act");var a=t.parents(".m-tabview").find(".tvbd>ul");a.find("li").removeClass("act"),a.find("li."+t.data().tabIndex).addClass("act")}).on("click",".show-select-ctn",s).on("click",".m-select-ctn li",o).on("change","input[name=logLevel]",a.dumply.filterLog).on("keyup","input[name=filterText]",t.throttle(a.dumply.filterLog,200))},f.dumply.bindAnrDetailList=function(){e(".dump-header").on("click",".btn-set-handled",function(){var a=t.parseDumplyParam(),n=e(this).hasClass("handled")?0:1;h.call(this,a.appId,a.typeId,n)}),e(".dump-list").on("click","li[data-log-id]",function(){e("div.panelbd:visible").addClass("loading"),e(this).parent().find("li").removeClass("act"),e(this).addClass("act");var n=t.parseDumplyParam();n.by="id",n.id=e(this).data("logId"),a.dumply.showAnrDetail(n)}).on("click",".m-paginator a.prev, .m-paginator a.next",function(){var a=e(this);if(a.not("[disabled]").length>0){var n=a.parent().data().limit||20,i=a.data().page,r=(i-1)*n,s=t.parseDumplyParam();s.offset=r,s.limit=n,s.version=e("#appVersion").text(),s.anrType=e("[data-anr-type]").data("anrType");var o={type:"POST",data:{queryAnrInfo:JSON.stringify(s)}};e.ajax("anr/getInfoList.do",o).then(function(a){a&&a.success?requirejs(["doT","moment"],function(t,r){var s=t.template(e("#dumpListTpl").html()),o=a.data&&a.data.list||[];o.forEach(function(e){e.insertTime=r(e.insertTime).format("YYYY-MM-DD HH:mm:ss")}),e(".dump-list ul").html(s(o)),e(".dump-list li").first().click();var d=parseInt(e("#anrTimes").text()),c={page:i||1,limit:n||20};c.offset=(c.page-1)*c.limit,c.totalPage=Math.ceil(d/c.limit);var l=t.template(e("#paginatorTpl").text());e(".dump-list ul").append(l(c))}):t.showAjaxError()})}}),e(".dump-detail").on("click",".tvhd.anr-detail li",function(){var t=e(this);t.parents("ul").find("li").removeClass("act"),t.addClass("act");var a=t.parents(".m-tabview").find(".tvbd>ul");a.find("li").removeClass("act"),a.find("li."+t.data("tabIndex")).addClass("act")}).on("click",".show-select-ctn",s).on("click",".m-select-ctn li",o).on("change","input[name=logLevel]",a.dumply.filterLog).on("keyup","input[name=filterText]",t.throttle(a.dumply.filterLog,200))},f.dumply.bindRealtime=function(){var a=e(".realtime").off();a.on("click",".m-date .idt",function(){e(this).prev().focus()}).on("click",".show-select-ctn",function(e){s.call(this,e)}).on("click",".m-select-ctn li",function(){o.call(this)}).on("change","input[name=version]",function(){var a=e(this).val(),n=e("#realTimeDatePicker").val(),i=MAS.User.currentApp.appId;t.createHash("#dumply/crashLog/realTime/#id="+i+"&version="+a+"&date="+n)}).on("click",".u-ex",function(){var t=e(this),a=t.parents("tr").next(".topview");t.hasClass("u-ex-1")?(t.text("展开").removeClass("u-ex-1").addClass("u-ex-2"),a.hide()):(a.removeClass("hidden").show(),t.text("收起").removeClass("u-ex-2").addClass("u-ex-1"))})},f.dumply.bindTrend=function(){e("#trendContainer").off().on("click",".tvhd li",function(){var t=e(this);t.addClass("act").siblings().removeClass("act"),t.parents(".tvhd").next(".tvbd").find("."+t.data("tabIndex")).show().siblings().hide()});var n=e("#trendContainer .tvbd .crash-trend").off();n.on("click",".show-select-ctn",function(e){s.call(this,e)}).on("click",".m-select-ctn li",function(){o.call(this)}).on("change","input[name=version]",function(){a.dumply.showTrend()}).on("change","input[name=period]",function(){"custom"===e(this).val()?e("#dateRange").data("dateRangePicker").open():a.dumply.showTrend()}).on("click",".crash-number a",function(){e(".crash-number a").removeClass("act"),e(this).addClass("act");var t=[];n.find(".version-list li.checked").each(function(a,n){var i=e(n).data("optionIndex").toString();""!=i&&t.push("0.0"!=i?i:"")});var i=n.find("input[name=period]"),r="",s="";if("custom"===i.val()){var o=i.parent("label").next().find(".selected-ctn").text().split(" to ");r=o[0],s=o[1]}var d={type:"POST",data:{appId:MAS.User.currentApp.appId,version:JSON.stringify(t),time:i.val(),startDate:r,endDate:s,chartType:e(this).data("chartType")}},c={dataUrl:"crash/getcrashtrend.do",time:d.data.time,ajaxParam:d,chartContainer:e(".crash-num-chart")[0],showLegend:!0};a.dumply.showTrendChart(c)}).on("click",".crash-time a",function(){var i=t.parseDumplyParam();n.find(".crash-time a").removeClass("act"),e(this).addClass("act");var r=[];n.find(".version-list li.checked").each(function(t,a){var n=e(a).data("optionIndex").toString();""!=n&&r.push("0.0"!=n?n:"")});var s=n.find("input[name=period]"),o="",d="";if("custom"===s.val()){var c=s.parent("label").next().find(".selected-ctn").text().split(" to ");o=c[0],d=c[1]}var l={type:"POST",data:{appId:MAS.User.currentApp.appId,version:JSON.stringify(r),time:s.val(),startDate:o,endDate:d,runTime:e(this).data().runTime}},p={dataUrl:"crash/querycrashtimetrend.do",time:i.period||l.data.time,ajaxParam:l,chartContainer:e(".crash-time-chart")[0],showLegend:!0};a.dumply.showTrendChart(p)});var i=e("#trendContainer .tvbd .anr-trend").off();i.on("click",".show-select-ctn",function(e){s.call(this,e)}).on("click",".m-select-ctn li",function(){o.call(this)}).on("change","input[name=version]",function(){a.dumply.showAnrTrend()}).on("change","input[name=period]",function(){"custom"===e(this).val()?e("#dateRangeAnr").data("dateRangePicker").open():a.dumply.showAnrTrend()}).on("click",".anr-number a",function(){i.find(".anr-number a").removeClass("act"),e(this).addClass("act");var t=[];i.find(".version-list li.checked").each(function(a,n){var i=e(n).data("optionIndex").toString();""!=i&&t.push("0.0"!==i?i:"")});var n=i.find("input[name=period]"),r="",s="";if("custom"===n.val()){var o=n.parent("label").next().find(".selected-ctn").text().split(" to ");r=o[0],s=o[1]}var d={type:"POST",data:{appId:MAS.User.currentApp.appId,version:JSON.stringify(t),time:n.val(),startDate:r,endDate:s,chartType:e(this).data("chartType")}},c={dataUrl:"anr/trend.do",time:d.data.time,ajaxParam:d,chartContainer:e(".anr-num-chart")[0],showLegend:!0};a.dumply.showTrendChart(c)})},f.dumply.bindTrendSelectDateRange=function(t){e(this).parents(".m-select3").find(".selected-ctn").html(t.value);var n=e("#trendContainer").find(".tvbd .crash-trend");requirejs(["moment"],function(e){var i=e(t.date1).format("YYYY-MM-DD"),r=e(t.date2).format("YYYY-MM-DD"),s="custom";"1970-01-01 to 1970-01-01"==t.value?(n.find(".period-content.show-select-ctn .selected-ctn").text("最近7天"),n.find("input[name=period]").val("week"),s="week",i="",r=""):"invalid date"==r.toLowerCase()&&(r=i,n.find(".period-content.show-select-ctn .selected-ctn").text(i+" to "+r)),a.dumply.showTrend({time:s,startDate:i,endDate:r})})},f.dumply.bindAnrTrendSelectDateRange=function(t){e(this).parents(".m-select3").find(".selected-ctn").html(t.value);var n=e("#trendContainer").find(".tvbd .anr-trend");requirejs(["moment"],function(e){var i=e(t.date1).format("YYYY-MM-DD"),r=e(t.date2).format("YYYY-MM-DD"),s="custom";"1970-01-01 to 1970-01-01"==t.value?(n.find(".period-content.show-select-ctn .selected-ctn").text("最近7天"),n.find("input[name=period]").val("week"),s="week",i="",r=""):"invalid date"==r.toLowerCase()&&(r=i,n.find(".period-content.show-select-ctn .selected-ctn").text(i+" to "+r)),a.dumply.showAnrTrend({time:s,startDate:i,endDate:r})})},f.dumply.bindSettingAppInfo=function(){e(".tvbd li.app-info").on("click",".show-select-ctn",function(e){s.call(this,e)}).on("click",".m-select-ctn li",function(){o.call(this)}).on("click",".applogo, .btn-update-logo",function(){e("#uploadForm").find("input:file").click()}).on("click",".btn-delete-app",function(){t.showMask(),e(".m-dialog-alert").show()}).on("click","#updateAppOK",function(){var a=e("input[name=appName]").val(),n=a.match(/[^\x00-\xff]/gi),i=a.length+(null==n?0:n.length);if(i>40||0==i)return t.niceAlert("产品名称不能为空且不能超过20个汉字或40个英文字符"),!1;var r=e("textarea[name=remark]").val(),s=r.match(/[^\x00-\xff]/gi),o=r.length+(null==s?0:s.length);if(o>400)return t.niceAlert("产品介绍描述过长，请不要超过200个汉字或400个英文字符"),!1;var d={};e("#appInfoContainer").find("input, textarea").each(function(t,a){var n=e(a).attr("name"),i=e(a).val();("radio"!=e(a).attr("type")||e(a).prop("checked"))&&(d[n]=i)}),e.ajax("app/update.do",{type:"POST",data:{appInfo:JSON.stringify(d),token:MAS.User.csrf}}).then(function(a){if(a.success){t.niceAlert("修改成功"),t.createHash("#dumply/crashLog/setting");var n=e("span.applogo").css("background-image");e("span.appname").text(d.appName).data("appName",d.appName),e(".app img.applogo").attr("src",e(".applogo input[name='logo']").data("logoUrl")),MAS.User.currentApp.logo=n.substring(4,n.length-1).replace(/"/g,""),MAS.User.currentApp.appName=d.appName,e(".app .dropmn table.app-list tr").each(function(t,a){e(a).data("appId")===MAS.User.currentApp.appId&&(e(a).find("h3 span:first").data("appName",d.appName).text(d.appName),e(a).find("td.cola img").attr("src",e(".applogo input[name=logo]").data("logoUrl")))}),t.setUserSettings({appName:d.appName,logo:d.logo},"lastAppInfo")}else t.showAjaxError(a)})}).on("change","input:file",function(){d.call(this)}).on("blur","input[name=appName]",function(){c.call(this)}).on("focus","input[name=appName]",function(){l.call(this)}).on("click",".toggle-key-style",function(){var t=e(this).parent().prev(),a="********************",n=t.data().appKey;t.text().indexOf(a)>-1?(t.text(n),e(this).text("隐藏部分")):(t.text(n.substr(0,20)+a),e(this).text("显示全部"))});var a=e(".m-dialog-alert");a.on("click",".dlclose, #btnAlertCancel",function(){a.fadeOut(),t.hideMask()}).on("click","#btnAlertOk",function(){var n=e(this).addClass("disabled").prop("disabled",!0),i={type:"POST",data:{appId:MAS.User.currentApp.appId,token:MAS.User.csrf}};e.ajax("app/realdelete.do",i).then(function(i){if(n.removeClass("disabled").prop("disabled",!1),i&&i.success===!0){var r=MAS.User.appList,s=MAS.User.currentApp;r.forEach(function(e,t){e.appId===s.appId&&MAS.User.appList.splice(t,1)}),e(".app-list tr").each(function(t,a){e(a).data().appId===s.appId&&e(this).hide().remove()}),MAS.User.currentApp=null,0===MAS.User.appList.length?(t.niceAlert("删除成功！您当前没有APP，请先添加APP。"),t.createHash("#userCenter/addApp")):(t.niceAlert("删除成功！将为您跳转到您的默认APP。"),t.createHash("#dumply/crashLog/crash/#id="+MAS.User.appList[0].appId),1===MAS.User.appList.length&&e(".appname.has-dropdown").removeClass("has-dropdown").next().remove())}else t.showAjaxError(i),a.fadeOut()},function(e){n.removeClass("disabled").prop("disabled",!1),a.fadeOut(),t.showAjaxError(e)})})},f.dumply.bindSettingVersion=function(){var n=MAS.User.currentApp;e(".tvbd li.version-manager").on("click",".btn-add-version",function(){t.showMask(),e("#addVersionDialog").show().find(".form-tip").show()}).on("click","#btnAddVerOK",function(){var a={appId:n.appId,version:e("input[name=version]").val(),packageName:e("input[name=packageName]").val()};e.ajax("version/insert.do",{type:"POST",data:{versionInfo:JSON.stringify(a),token:MAS.User.csrf}}).then(function(e){e&&e.success?(t.hideMask(),t.createHash("#dumply/crashLog/setting/#subTab=version-manager&id="+n.appId)):t.showAjaxError(e)})}).on("click","#btnAddVerCancel",function(){e(this).parents(".m-dialog").hide().find("input.u-ipt3").val(""),t.hideMask()}).on("click","a.btn-upload",function(){var t={appId:n.appId,version:e(this).parent().data().version,packageName:e(this).parent().data().packageName},a=e(this).hasClass("btn-upload-symbol"),i=e("form.upload-form"),r=a?".zip":".txt";i.find("input[name=versionInfo]").val(JSON.stringify(t)),i.find("input[name=isSymbol]").val(a),i.find("input[type=file]").attr("accept",r).click()}).on("mouseenter",".u-tag",function(){e(this).find("span.delete").show()}).on("mouseleave",".u-tag",function(){e(this).find("span.delete").hide()}).on("click",".delete",function(a){a.preventDefault(),a.stopPropagation();var i,r={appId:n.appId,version:e(this).parents(".vsinfo").data().version,packageName:e(this).parents(".vsinfo").data().packageName};e(this).hasClass("symbol")?(r.symbolStatus=0,i=!0):(r.mappingStatus=0,i=!1);var s=MAS.User.currentApp.appId,o={type:"POST",data:{versionInfo:JSON.stringify(r),isSymbol:i,token:MAS.User.csrf}};e.ajax("version/update.do",o).then(function(e){e&&e.success?t.createHash("#dumply/crashLog/setting/#subTab=version-manager&appId="+s):t.showAjaxError(e)})}).on("click",".dlclose",function(){e(this).parents(".m-dialog").hide().find("input.u-ipt3").val(""),t.hideMask()}).on("click",".enable-version",function(){var a=e(this);t.niceAlert({str:{title:"注意",alertContent:"确定开启上报？",subContent:" "},btns:{ok:!0,cancel:!0,close:!0},callback:{ok:function(){var i=a.parent().prev(),r={type:"POST",data:{versionInfo:JSON.stringify({enable:1,appId:n.appId,version:i.data("version"),packageName:i.data("packageName")}),token:MAS.User.csrf}};e.ajax("version/updatestatus.do",r).then(function(e){e&&e.success?a.text("关闭上报").removeClass("enable-version").addClass("disable-version"):t.showAjaxError(e)})},cancel:void 0},hideMask:!0})}).on("click",".disable-version",function(){t.showMask();var a=e(this),n=a.parent().prev(),i={versionInfo:JSON.stringify({enable:0,appId:MAS.User.currentApp.appId,version:n.data("version"),packageName:n.data("packageName")}),token:MAS.User.csrf},r=e(".m-dialog-close-ver");r.show().off().on("click","#btnCloseVerOk",function(){e.ajax("version/updatestatus.do",{type:"POST",data:i}).then(function(e){e&&e.success?(a.text("开启上报").removeClass("disable-version").addClass("enable-version"),r.hide(),t.hideMask()):t.showAjaxError(e)})}).on("click","#btnCloseVerCancel",function(){r.hide(),t.hideMask()})}).on("click",".show-select-ctn",s).on("click",".m-select-ctn li",o).on("change","input[name=enable].hidden",a.dumply.showVersionList),e(".upload-form").on("change","input:file",function(){p.call(this,t)})},f.dumply.bindSettingMember=function(){var a=e(".m-dialog-add-member");e(".tvbd li.member").on("click",".btn-delete-member",function(){var a=e(this);t.niceAlert({str:{alertContent:"确定要删除这条成员信息吗？"},btns:{cancel:!0},callback:{ok:function(){var n=a.parents("tr"),i={type:"POST",data:{email:n.data().userEmail,appId:MAS.User.currentApp.appId,token:MAS.User.csrf}};e.ajax("member/delete.do",i).then(function(e){e&&e.success?n.hide().remove():t.showAjaxError(e)})}}})}).on("click",".btn-invite-member",function(){e.ajax("/yun/sendemail.do",{data:{email:e(this).data("email"),token:MAS.User.csrf}}).then(function(e){e&&e.success?t.niceAlert("邀请邮件发送成功"):t.niceAlert(e.msg)},function(){t.niceAlert()})}).on("click",".btn-add-member",function(){t.showMask(),a.fadeIn(200),a.get(0).scrollIntoView(400)}).on("click",".show-select-ctn",function(e){s.call(this,e)}).on("click",".m-select-ctn li",function(){o.call(this)}).on("change","input.hidden[name=role]",function(){var a=e(this),n=e(this).parents("tr"),i=e(this).val(),r={type:"POST",data:{memberInfo:JSON.stringify({email:n.data().userEmail,appId:MAS.User.currentApp.appId,role:i}),token:MAS.User.csrf}};e.ajax("member/update.do",r).then(function(e){if(e&&e.success)t.niceAlert("修改成功"),a.attr("data-old-value",i);else{var r=a.attr("data-old-value");if(i!=r){var s=0==i?"成员":"管理员";n.find(".selected-ctn").text(s),a.val(parseInt(r))}t.showAjaxError(e)}})}),a.off().on("click","a.dlclose",function(){e(".m-mask").fadeOut(200),a.fadeOut(100)}).on("click",".show-select-ctn",function(e){s.call(this,e)}).on("click",".m-select-ctn li",function(){o.call(this)}).on("click",".btn-add-more",function(){var t=e(this).parents(".control");t.find(".roleInputGroup").last().after(t.find(".roleInputGroup.hidden").clone().removeClass("hidden"))}).on("click","#btnAddRoleOK",function(){var a=MAS.User.currentApp.appId,n=[];e(".roleInputGroup:visible").each(function(t,i){var r={appId:a,appName:MAS.User.currentApp.appName},s=e(i).find("input[name=email]");r.email=s.val().trim(),r.role=e(i).find("input[name=role]").val(),r.email&&n.push(r),s.toggleClass("error",""!==r.email&&!/(^[\S]*@[a-zA-Z0-9-.]*\.\w{2,6}$)|(1\d{10})/.test(r.email))});var i=e("#btnAddRoleOK").next(".form-tip");if(0===n.length)return void i.text("请至少填写一个邮箱或手机号").show().fadeOut(1600);if(e("input[name=email]:visible.error").length>0)return void i.text("请更正错误的邮箱地址后再进行提交").show().fadeOut(2e3);var r={type:"POST",data:{memberInfo:JSON.stringify(n),token:MAS.User.csrf}};e.ajax("member/insert.do",r).then(function(n){n&&n.success?(t.niceAlert("添加成员成功"),e(".m-mask").hide(),t.createHash("#dumply/crashLog/setting/#subTab=member&id="+a)):t.showAjaxError(n)})})},f.dumply.bindSettingAlert=function(){var n=e("#alertSettingContent"),i=n.find(".alert-content"),r=MAS.User.currentApp.appId,d=i.data("warnType"),c=i.data("id"),l=MAS.User.csrf;n.on("change","input[name=alertStatus]",function(){var n=e("input[name=alertStatus]:checked").val();if("on"===n)return e(".alert-content > .m-box").removeClass("hidden").show(),void e.ajax("user/isbind.do").then(function(e){e&&e.success&&e.data&&!e.data.isbind&&t.niceAlert({str:{title:"完善邮箱",alertContent:"您当前账号还未绑定邮箱，请绑定邮箱哦~~",subContent:"听说没有绑定邮箱就不能接收报警邮件了"},btns:{ok:!0,okStr:"绑定邮箱",cancel:!0,cancelStr:"以后再说",close:!1},callback:{ok:function(){t.createHash("#userCenter/profile")}}})});a.common.showLoading(i);var s={warnJson:JSON.stringify({appId:r,id:c,warnType:d,enable:!1}),token:MAS.User.csrf};e.ajax("warn/config.do",{type:"POST",data:s}).then(function(n){a.common.hideLoading(i),n&&n.success?e(".alert-content > .m-box").hide():t.showAjaxError(n)},function(){a.common.hideLoading(i),t.niceAlert("网络错误，请稍候稍后重试。")})}).on("focus","input[data-tip-msg]",function(){e("input.u-btn-save-alert").next(".form-tip").removeClass("error").text(e(this).data("tipMsg")).show()}).on("blur","input[data-validate]",function(t){var a=e(this);e("input.u-btn-save-alert").next(".form-tip").text("").removeClass("error").hide();var n=new RegExp(a.data("validate"));a.toggleClass("error",!n.test(a.val()))}).on("click",".show-select-ctn",function(e){s.call(this,e)}).on("click",".m-select-ctn li",function(){o.call(this)}).on("click",".u-btn-save-alert",function(){var a=e(this);if(e("input[data-validate].error:visible").length>0)return void a.next(".form-tip").text("包含不正确的字段，请更正后再提交").addClass("error").show();var n={appId:r,enable:!0,warnType:d};if(0==d){var i=[],s=!1;e(".m-select3.version-list:visible li.checked").each(function(t,a){var n=String(e(a).data("optionIndex"));""===n?s=!0:i.push(n)}),n.version=s?JSON.stringify(["0.0"]):JSON.stringify(i);var o=e("input[type=checkbox]:visible");o.closest("li").find("input[data-validate]:visible").each(function(t,a){var i=e(a);n[i.data("key")]=e(a).val()}),o.each(function(t,a){n[e(a).attr("name")]=e(a).prop("checked")}),n.frequency=e("input[data-key=frequency]").val()}else if(1==d){var o=e("input[type=checkbox]:visible");o.each(function(t,a){n[e(a).attr("name")]=e(a).prop("checked")}),o.closest("li").find(".m-select3.version-list input.hidden").each(function(t,a){var i=e(a);if(i.parents(".m-select3").find("li[data-option-index='']").hasClass("checked"))n[i.attr("name")]=JSON.stringify(["0.0"]);else{var r=[];i.parents(".m-select3.version-list:visible").find("li.checked").each(function(t,a){var n=String(e(a).data("optionIndex"));r.push(n)}),n[i.attr("name")]=JSON.stringify(r)}})}else{n.enable=!0,n.sendTime=e("#dailyReportPicker").val();var i=[],s=!1;e(".m-select3.version-list:visible li.checked").each(function(t,a){var n=String(e(a).data("optionIndex"));""===n?s=!0:i.push(n)}),n.version=s?JSON.stringify(["0.0"]):JSON.stringify(i)}var c={type:"POST",data:{warnJson:JSON.stringify(n),token:l}};e.ajax("warn/config.do",c).then(function(n){if(n&&n.success){var i=2===d?"日报信息更新成功":"报警信息更新成功";a.next(".form-tip").text(i).show().fadeOut(2e3,function(){0!==d&&1!==d||0!==e("input[type=checkbox]:visible:checked").length||a.next(".form-tip").text("您未勾选任何报警条件，将不会收到报警信息").show()})}else t.showAjaxError(n)},function(){t.niceAlert("网络错误，请稍后重试")})}).on("mouseenter",".u-tag",function(){e(this).find("span.delete").show()}).on("mouseleave",".u-tag",function(){e(this).find("span.delete").hide()}).on("click",".delete",function(){var a=e(this),n=i.data("id"),s=i.data("warnType"),o=[],d=a.parent().data().email,c=a.parents("li").data("alertType");a.parents(".ntmem").find(".u-tag").each(function(t,a){var n=e(a).data("email");n!==d&&o.push(n)});var p={appId:r,warnType:s,id:n};p[c]=o.join(",");var u={type:"POST",data:{warnJson:JSON.stringify(p),token:l}};e.ajax("warn/updatemember.do",u).then(function(e){e.success?a.parent().hide().remove():t.showAjaxError(e)})}).on("click",".btn-add-alert",function(){var a=e(this);if(!a.attr("disabled")){t.showMask();var n=MAS.User.currentApp.appId,r=i.data("warnType"),s=i.data("id"),o=a.parent().data("alertType"),d=MAS.User.csrf,c={data:{queryMemberInfo:JSON.stringify({appId:n,warnType:r})}};e.ajax("warn/queryemaillist.do",c).then(function(i){i&&i.success?requirejs(["doT"],function(c){var l=e("#alertSelectorTpl").text(),p=e(".m-dialog-add-alert"),u=c.template(l),h=i.data||{};h.alertType=o;var f=u(h);if(p.find(".control").find(".input-container").remove(),p.find(".add-alert .control").html(f),"popo"===o){var m=c.template('{{~it.emailList :email:index}} <li data-option-index="{{=email.member}}">{{=email.member}}</li> {{~}}');if(p.find(".m-select-ctn > ul").html(m(h)),p.addClass("popo"),0===p.find(".input-container").length){var v=c.template(e("#emptyPopoTpl").text());e(".addmem").before(v(h))}}else p.removeClass("popo");""===p.find(".selected-ctn").text().trim()&&p.find(".selected-ctn").text("请选择接收的用户"),p.show().off().on("click",".dlclose, #btnAddAlertCancel",function(){t.hideMask(),e(this).parents(".m-dialog").hide()}).on("click","a.btn-add-more",function(){var t=c.template(e("#emptyPopoTpl").text());e(".addmem").before(t(h))}).on("click","#btnAddAlertOK",function(){var i=(e(this),{appId:n,id:s,warnType:r});if("popo"!==o){var c=[];e(".m-dialog-add-alert:visible .m-select3.multi li.checked").each(function(t,a){var n=e(a).data("optionIndex");""!==n&&c.push(n)}),i[o]=c.join(",")}else i.popo=[],e(".m-dialog-add-alert:visible .m-select3").each(function(t,a){var n=e(a).find("input.hidden").val(),r=e(a).next("input").val();""!==n&&""!==r&&i.popo.push(n+"#"+r)}),i.popo=i.popo.join(",");var l={type:"POST",data:{warnJson:JSON.stringify(i),token:d}};e.ajax("warn/updatemember.do",l).then(function(e){t.hideMask(),a.parents(".m-dialog").hide(),e&&e.success?t.createHash(location.hash):(a.parents(".m-dialog").hide(),t.showAjaxError(e))},function(){t.niceAlert("网络错误，请稍后重试")})})}):t.showAjaxError(i)})}}).on("click",".tvhd li",function(){var a=e(this);a.parents("ul").find("li").removeClass("act"),a.addClass("act");var n=a.parents(".m-tabview").find(".tvbd>ul");n.find("li").removeClass("act"),n.find("li."+a.data("tabIndex")).addClass("act").html("").addClass("loading"),
t.createHash("#dumply/crashLog/alert/#id="+MAS.User.currentApp.appId+"&subTab="+a.data("tabIndex"))}).on("keydown","input[name=sendTime]",function(e){e.preventDefault()})},f.dumply.bindFaq=function(){e(".faq-nav").on("click","li[data-sdk-type]",function(){e("li[data-sdk-type]").removeClass("act"),e(this).addClass("act"),t.createHash(e(this).find("a").attr("href"))}).on("click",".list-title",function(){var t=e(this).next();t.is(":visible")?(t.hide(200),e(this).find("i").addClass("collapse")):(t.show(200),e(this).find("i").removeClass("collapse"))}).on("click","#declareEditBtn",function(){var t=e(".faq-editor");t.is(":visible")?(e(this).text("编辑说明"),t.hide()):(e(this).text("取消编辑"),t.show())}),e(".faq-subnav ul").on("click","li a",function(){var t="#"+e(this).data().href;e("html, body").animate({scrollTop:e(t).offset().top},500)}),e(window).on("scroll",function(){var t,a=e(".faq-detail h1, .faq-detail h2"),n=e(".faq-subnav li");a.each(function(i,r){var s=e(this).offset().top,o=e(document).scrollTop();o>=s-10&&(t=e("[data-href='"+e(r).attr("id")+"']").parent()),i==a.length-1&&t&&(n.removeClass("active"),t.addClass("active"))})}),e(window).bind("beforeunload",function(){return CKEDITOR.instances.declareContet.checkDirty()?"您正在编辑的内容尚未保存！如果离开，未保存的内容将会丢失！":void 0}),e(".faq-editor input[type=submit]").on("click",function(a){a.preventDefault();var n={token:MAS.User.csrf,os:e("input[name=os]").val(),sdkType:e("input[name=sdkType]").val(),content:e("textarea[name=content]").val()};return e.ajax("faq/edit.do",{type:"POST",data:n}).then(function(a){a&&a.success?(e(window).unbind("beforeunload"),t.niceAlert("修改成功"),t.createHash("#dumply/faq/"+n.os+"/"+n.sdkType)):t.showAjaxError(a)}),!1})},f.dumply.bindUpdateSDK=function(){var a=e(".m-dialog-upload-sdk").off();a.on("click",".show-select-ctn",function(e){s.call(this,e)}).on("click",".m-select-ctn li",function(){o.call(this)}).on("click","#btnUploadSdkOK",function(){var n=e(this),i=a.find("input[name=version]"),r=a.find("input[type=file]");if(""==i.val().trim()||""==r.val())return void n.next().text("版本或文件不能为空").addClass("error").show().fadeOut(2e3);var s=a.find("form");s.find("input[name=token]").val(MAS.User.csrf),t.upload(s,{uploadCb:function(a){a&&a.success===!0?(n.next().removeClass("error").text("上传成功").show().fadeOut(2e3),e(".file-info, .progress").text(""),i.val(""),r.val("")):t.showAjaxError(a,!1)},progressCb:function(e){if(e.lengthComputable){var t=parseInt(e.loaded/e.total*100);a.find(".progress").text(t+" %"),100===t&&a.find(".progress").text("上传完成，等待服务器处理完毕")}}})}).on("click",".file-trigger",function(){e(this).parents(".control").find("input[type=file]").click()}).on("click",".dlclose",function(){t.hideDialog()}).on("change","input[type=file]",function(){if(this.files){var e=this.files[0]||{name:"",size:0},t=e.name+" - "+(e.size/1024/2014).toFixed(2)+"MB";a.find(".file-info").text(t)}else a.find("input[type=file]").show()})},f.dumply.bindUpdateSysSymbol=function(){var a=e(".m-dialog-upload-sys-symbol").off();a.on("click",".show-select-ctn",function(e){s.call(this,e)}).on("click",".m-select-ctn li",function(){o.call(this)}).on("click","#btnUploadSysSymbolOK",function(){if(""==a.find("input[type=file]").val())return void a.find(".form-tip").show().fadeOut(2e3);var n=a.find("form");n.find("input[name=token]").val(MAS.User.csrf),t.upload(n,{uploadCb:function(n){n&&n.success?(t.niceAlert("上传成功"),t.showMask(),e(".file-info, .progress").text(""),a.find("input[name=version]").val(""),a.find("input[type=file]").val("")):t.showAjaxError(n)},progressCb:function(e){if(e.lengthComputable){var t=parseInt(e.loaded/e.total*100);a.find(".progress").text(t+" %"),100===t&&a.find(".progress").text("上传完成，等待服务器处理完毕")}}})}).on("click",".file-trigger",function(){e(this).parents(".control").find("input[type=file]").click()}).on("click",".dlclose",function(){t.hideDialog()}).on("change","input[name=osType]",function(){var t=e(this),a=e("input[name=osVersion]"),n=a.parent();a.val(""),n.find(".selected-ctn").text("请选择"),requirejs(["doT","apkpack/utils/data"],function(e,a){var i=e.template("<li data-option-index='{{=it}}'>{{=it}}</li>"),r=a.sysVersion[t.val()],s="<li data-option-index='all'>所有版本</li>";r&&r.length>0&&r.forEach(function(e){s+=i(e)}),n.find(".m-select-ctn ul").html(s)})}).on("change","input[type=file]",function(){if(this.files){var e=this.files[0]||{name:"",size:0},t=e.name+" - "+(e.size/1024/2014).toFixed(2)+"MB";a.find(".file-info").text(t)}else a.find("input[type=file]").show()})},f});