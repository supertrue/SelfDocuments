define(["jquery","doT","apkpack/utils/listener","apkpack/utils/renderer","apkpack/utils/utils","apkpack/utils/renderUtils"],function(e,t,a,i,n,s){function o(){this.toggleBanner=function(t){$header=e(".doc > .header"),$top=$header.find(".top"),t?($top.find(".logo img").attr("src","image/index/logo.png"),$top.find("i.arr").removeClass("default"),$header.removeClass("default")):($top.find(".logo img").attr("src","image/newStyle/logo_v5.png"),$top.find("i.arr").addClass("default"),$header.addClass("default"))},this.router=function(o){var l=o.split("/"),d=new i,r=l[0],c={"":function(){if(!(e("div#specialPageDefaultHeader").length>0)){s.common.setHeader("index");var t=e("noscript").text();""===t&&e.ajax("html/home.html",{async:!1,success:function(e){t=e}}),e(".content.home").html(t),n.showRightSideBtns(),String(navigator.platform).indexOf("Linux")>-1&&e(".bigtitle h3").css("fontWeight","normal"),e(window).width()>720&&require(["slick"],function(t){e(".app-marquee").slick({autoplay:!0,slidesToShow:5,prevArrow:".app-marquee-prev",nextArrow:".app-marquee-next"})});var a,i,o,l;i=e(".content.home .page"),o=e(document),l=e(window),a=l.height();var d=function(){i.each(function(t,i){var n,s;if(n=e(this),!n.hasClass("animate")){s=o.scrollTop();var l=n.find("h2 + p");l.length&&s+a>l.offset().top+l.height()+300&&n.addClass("animate")}})};l.on("scroll",d),e(".menu-button").on("click",function(){e(this).toggleClass("act")}),e(".content").removeClass("visible"),e(".content.home").addClass("visible")}},"#feature":function(){var t=e(".content");s.common.setHeader("feature"),n.goTop();var a=e(".content.feature");a.find(".detail-ctn>div").length>0?(t.removeClass("visible"),a.addClass("visible")):requirejs(["apkpack/module/feature"])},"#news":function(){s.common.setHeader("default"),n.showRightSideBtns(),n.goTop(),requirejs(["apkpack/module/news"],function(e){e.render()})},"#login":function(){d.login()},"#apkpack":function(){var i="index",o="";switch(l.length>1&&(i=l[1],o=l.slice(2)),i){case"index":s.common.setHeader("index"),MAS.Widget.Carousel.showStatic(0).hidePointer().stop(),requirejs(["text!../html/apkpack/index.html"],function(i){var n,s=t.template(i);e.ajax("getDownloadUrl.do").then(function(e){n=e}).always(function(){e(".content").removeClass("visible"),e(".content.apkpack").html(s(n)).addClass("visible"),a.apkpack.bindIndex()})});break;case"result":s.common.setHeader("default"),requirejs(["text!../html/apkpack/result.html"],function(i){var s,l=t.template(i),d={inserttime:o[0]?o[0]:"",page:o[1]?o[1]:1,perpage:o[2]?o[2]:20,operator:o[3]?o[3]:""};e.ajax("apkpack/resultList.do",{type:"POST",data:d}).then(function(e){s=e}).always(function(){return s.data&&s.data.user?(e(".content").removeClass("visible"),e(".content.apkpack").html(l(s)).addClass("visible"),a.apkpack.bindResult(s),void(o[3]&&e("#operator").find("select").val(o[3]))):void n.createHash("#apkpack")})});break;case"faq":s.common.setHeader("default"),requirejs(["text!../html/apkpack/faq.html"],function(a){var i,n=t.template(a);e.ajax("getDownloadUrl.do").then(function(e){i=e}).always(function(){MAS&&MAS.Widget&&MAS.Widget.Nav&&MAS.Widget.Nav.changeActive("#apkpack/faq"),e(".content").removeClass("visible"),e(".content.apkpack").html(n(i)).addClass("visible"),"apksigner"==o[0]&&e("html, body").animate({scrollTop:e("#apksignerHelp").offset().top},500)})});break;case"feature":d.apkpack().renderFeature();break;default:n.createHash("#apkpack")}},"#dumply":function(){var i="crashLog",o="";l.length>1&&(i=l[1],o=l.slice(2));var r=e(".content.dumply");switch(i){case"crashLog":var c=""==o[0]||void 0==o[0]?"crash":o[0];s.common.setHeader("wide"),MAS&&MAS.Widget&&MAS.Widget.Nav&&MAS.Widget.Nav.changeActive("#dumply/crashLog/crash/#all=true"),requirejs(["apkpack/module/dumply/index"],function(t){e(".content").removeClass("visible").filter(".dumply").addClass("visible"),t.renderIndex().then(function(){n.showRightSideBtns(),n.goTop(),localStorage.getItem("isReadAnr")||e("a.anr",".content.dumply .topmenu").addClass("new-feature"),localStorage.getItem("isReadAlert")||e("a.alert",".content.dumply .topmenu").addClass("new-feature"),e(".dumply.content").addClass("wide"),t.renderSubPage(c)})});break;case"downloadSDK":r.removeClass("wide"),n.goTop(),requirejs(["text!../html/dumply/sdk.html"],function(a){var i=t.template(a),n=(new Date).toISOString().substr(0,15),o="crash.163.com"===window.location.host||window.location.host.indexOf(".163yun.com")>=0?"http://crash-public-online.nos.netease.com":"http://apk-pack-public-test.nos.netease.com";s.common.setHeader("default"),e(".content").removeClass("visible"),e(".content.dumply").html(i({now:n,url:o})).addClass("visible"),MAS&&MAS.Widget&&MAS.Widget.Nav&&MAS.Widget.Nav.changeActive("#dumply/downloadSDK"),e.ajax("queryAllSdkFile.do").done(function(t){if(t&&t.success){var a=t.data||{};a.now=n,a.url=o,e(".content.dumply").html(i(a))}})});break;case"sdk":if(r.removeClass("wide"),s.common.setHeader("default"),0==MAS.User.role){var u="#dumply/downloadSDK";location.hash!=u&&n.createHash(u),n.showMask(),e(".m-dialog-upload-sdk").show(),a.dumply.bindUpdateSDK()}break;case"sysSymbol":if(r.removeClass("wide"),0==MAS.User.role){var u="#dumply/downloadSDK";location.hash!=u&&n.createHash(u),n.showMask(),e(".m-dialog-upload-sys-symbol").show(),a.dumply.bindUpdateSysSymbol()}break;case"detailList":s.common.setHeader("wide"),e(".dumply.content").addClass("wide"),requirejs(["text!../html/dumply/detailList.html"],function(t){e(".content").removeClass("visible"),e(".content.dumply").html(t).addClass("visible"),MAS&&MAS.Widget&&MAS.Widget.Nav&&MAS.Widget.Nav.changeActive("#dumply/crashLog/crash/#all=true"),d.dumply.detailList(),a.dumply.bindDetailList()});break;case"anrDetailList":s.common.setHeader("wide"),e(".dumply.content").addClass("wide"),requirejs(["text!../html/dumply/anrDetailList.html"],function(t){e(".content").removeClass("visible"),e(".content.dumply").html(t).addClass("visible"),MAS&&MAS.Widget&&MAS.Widget.Nav&&MAS.Widget.Nav.changeActive("#dumply/crashLog/crash/#all=true"),d.dumply.anrDetailList(),a.dumply.bindAnrDetailList()});break;case"solution":s.common.setHeader("default"),requirejs(["text!../html/dumply/solution.html"],function(t){e(".content").removeClass("visible"),e(".content.dumply").html(t).addClass("visible"),MAS&&MAS.Widget&&MAS.Widget.Nav&&MAS.Widget.Nav.changeActive("#dumply/crashLog/crash/#all=true"),requirejs(["apkpack/module/dumply/solution"],function(e){var t=o[0];e.render(t)})});break;case"faq":r.removeClass("wide"),n.goTop(),s.common.setHeader("default"),n.showRightSideBtns(),requirejs(["text!../html/dumply/faq.html","ckeditor-core","ckeditor-jquery"],function(i){var n=t.template(i);e(".content").removeClass("visible"),e(".content.dumply").html(n(MAS.User.role||"")).addClass("visible"),MAS&&MAS.Widget&&MAS.Widget.Nav&&MAS.Widget.Nav.changeActive("#dumply/downloadSDK");var s=o.length>0&&o[0]?o[0]:"android",l=o.length>1&&o[1]?o[1]:"java";e("ul[data-sdk-os="+s+"]").find("li[data-sdk-type="+l+"]").addClass("act"),e("input[name=os]").val(s),e("input[name=sdkType]").val(l);var d="faq/read.do?os="+s+"&sdkType="+l;e.ajax(d).then(function(i){var n=i.data&&i.data.data||"";e(".faq-detail").html(n),e("#declareContet").val(n).ckeditor(),e(document).ready(function(){e("pre code").each(function(e,t){hljs.highlightBlock(t)}),e(".faq-nav").css("height",e(".faq-detail").outerHeight()-42);var i=e(".faq-subnav ul").off().html("");e(".faq-detail h1, .faq-detail h2").each(function(a,n){var s=e(n),o="faqSubNav-"+a,l=s.text().trim(),d="H2"===s.get(0).nodeName,r="<li {{?it.isSubheading}}class='sub-heading'{{?}}><a href='javascript:void(0);' data-href='{{=it.href}}' title='{{=it.text}}'>{{=it.text}}</a></li>",c=t.template(r);i.append(c({href:o,text:l,isSubheading:d})),s.attr("id",o)}),a.dumply.bindFaq()})})});break;case"q&a":r.removeClass("wide"),s.common.setHeader("default"),n.goTop(),n.showRightSideBtns(),requirejs(["apkpack/module/q&a"],function(e){e.render(),MAS&&MAS.Widget&&MAS.Widget.Nav&&MAS.Widget.Nav.changeActive("#dumply/downloadSDK")});break;default:n.createHash("#dumply/crashLog/")}},"#download":function(){s.common.setHeader("default");var a=null;requirejs(["text!../html/download/apkpackTool.html"],function(i){var n=t.template(i);e.ajax("getDownloadUrl.do").then(function(e){a=e}).always(function(){e(".content").removeClass("visible"),e(".content.download").html(n(a)).addClass("visible")})})},"#userCenter":function(){var i="appList",o=MAS.User.account;if(!o){n.goLogin(location.hash);location.hash;if(e(".content.feature").hasClass("visible"))return;if(e(".sdk:visible").length>0)return;return void n.showRightSideBtns()}if("cursLoginSuccess"!==o){s.common.setHeader("wide"),n.goTop();var d=["appList","profile","solutionList","myScore","addApp"];l&&d.indexOf(l[1])>-1&&(i=l[1]),requirejs(["text!../html/userCenter/index.html"],function(l){var d=e(".userCenter");if(e(".content.userCenter").html(l),"addApp"===i)return n.goTop(),d.find("#userCenterDash").hide(),e(".content").removeClass("visible"),e(".content.userCenter").addClass("visible"),e.ajax("app/myappcount.do").then(function(t){if(t&&t.success){var a="您最多可以创建99个APP，当前已经创建了 "+t.data.num+" 个。";e("#addAppDash .add-app-tip").text(a)}}),void a.userCenter.bindAddApp();d.find("#addAppDash").hide(),e(".content").removeClass("visible"),e(".content.userCenter").addClass("visible");var r,c,u,p,m;switch(d.find("li").removeClass("act"),i){case"profile":d.find("li.profile").addClass("act"),r=e("#profileTpl").html(),c="profile/querybyid.do",m=e(".user-info-form"),u={type:"POST",data:{email:o}};break;case"solutionList":n.showRightSideBtns(),d.find("li.solution-list").addClass("act"),r=e("#mySolutionListTpl").html(),c="solution/list.do",m=e("li.solution-list tbody"),u={};break;case"myScore":d.find("li.my-score").addClass("act"),r="{{=it.object.score}}",c="profile/querybyid.do",m=e(".score-list-container .score"),u={type:"POST",data:{email:o}};break;case"appList":default:n.showRightSideBtns(),d.find("li.app-list").addClass("act"),r=e("#appListTpl").html(),c="app/querymyapplist.do",m=e("li.app-list tbody"),p={email:o},u={type:"POST",data:{queryMemberInfo:JSON.stringify(p)}}}e.ajax(c,u).done(function(a){if(a&&a.success){var s=t.template(r);if(a.data?a.data.object?a.data.list||(a.data.list=[]):a.data.object={}:a.data={list:[],object:{}},a&&a.data&&a.data.list){var o=a.data.list;o.forEach(function(e){e&&(e.createTime||e.insertTime)&&(e.createTime=new Date(e.createTime).toLocaleDateString(),e.insertTime=new Date(e.insertTime).toLocaleDateString())})}m.html(s(a.data)),"profile"==i?(1==e(".user-info-form").find("input[type=radio]:checked").val()&&e(".fitem.enterprise").show(),e.ajax("app/queryoptandphonestatus.do").then(function(t){return e(".security-check").hide(),t&&t.success&&t.data&&t.data.result?void e(".security-check.binded").show():void e(".security-check.notbind").show()}),requirejs(["apkpack/utils/data"],function(i){var n=a.data.object||{},s=n.province||0,o=n.city||0,l=n.district||0,d=e(".province-select"),r=e(".city-select"),c=e(".district-select"),u=i.province,p=i.city[s]||[],m=i.district[s]&&i.district[s][o]||[],h="{{~it:subType:index}}<li data-option-index='{{=index}}'>{{=subType}}</li>{{~}}",f=t.template(h);d.find(".m-select-ctn ul").html(f(u)),d.find(".selected-ctn").html(u[s]),r.find(".m-select-ctn ul").html(f(p)),r.find(".selected-ctn").html(p[o]),c.find(".m-select-ctn ul").html(f(m)),c.find(".selected-ctn").html(m[l])})):"appList"==i&&(MAS.User.appList=a.data&&a.data.list||[],location.hash.indexOf("/#!comfirmBindEmail=true")>=0&&n.niceAlert({str:{title:"完善邮箱",alertContent:"您当前账号还未绑定邮箱，请绑定邮箱哦~~",subContent:"听说没有绑定邮箱就不能接收报警邮件了"},btns:{ok:!0,okStr:"绑定邮箱",cancel:!0,cancelStr:"以后再说",close:!1},callback:{ok:function(){n.createHash("#userCenter/profile")}}}))}else{var l=a&&a.msg?a.msg:"一定是点击姿势不对，请您换个姿势再点";n.niceAlert(l)}}).error(function(){n.niceAlert("一定是点击姿势不对，请您换个姿势再点击")}).always(function(){s.common.hideLoading(e("li.act.loading")),a.userCenter.bindIndex()})})}}};c[r]?(c[r].call(this),MAS&&MAS.Widget&&MAS.Widget.Nav&&MAS.Widget.Nav.changeActive(r)):location.replace("/")}}return new o});